<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
    <title>原生js交互 测试</title>
    <script>
        /**
            调用方法传参 统一格式 JSON格式字符串
            {"actionID": 1, param:{"key1": "val1", "key2": "val2"}}

        */

        const clientRegistedMethodName = "clientRegistedMethod"; // 客户端注册的js handle
        const jsHandleFunctionName = "jsRegistedFunction"; // js注册的方法名称
        function setupWebViewJavascriptBridge(callback) {
            if (window.WebViewJavascriptBridge) {
                return callback(WebViewJavascriptBridge);
            } else if (window.WVJBCallbacks) {
                return window.WVJBCallbacks.push(callback);
            } else {
                document.addEventListener(
                    'WebViewJavascriptBridgeReady',
                    function () {
                        return callback(WebViewJavascriptBridge)
                    },
                    false
                );
            }
            window.WVJBCallbacks = [callback];
            var WVJBIframe = document.createElement('iframe');
            WVJBIframe.style.display = 'none';
            WVJBIframe.src = 'https://__bridge_loaded__';
            document.documentElement.appendChild(WVJBIframe);
            setTimeout(function () {
                document.documentElement.removeChild(WVJBIframe)
            }, 0)
        }

        
        setupWebViewJavascriptBridge(function (bridge) {

            // 这里主要是注册 JS 方法。
            bridge.registerHandler(jsHandleFunctionName, function (data, responseCallback) {
                // 这里取出data里actionID 判断该做什么
                dataObj = JSON.parse(data);
                if (dataObj.actionID == 1) {
                    // dataObj.param 为用户信息, 这里js后续处理
                    
                }
                
                
                // 如果需要返回结果给原生调用下面的方法
                result = {
                    info: 'js执行后返回的结果'
                };
                responseCallback(JSON.stringify(result));
            });


            // 初始化
            bridge.init(function (message, responseCallback) {
                var data = {
                    'Javascript Responds': 'Wee!'
                };
                responseCallback(data);
            });
        });



        function handleBtnAction() {

            param = {
                actionID: 1, // 代表调用原生，登录超时，返回登录页面。 此时不需要param
                param: {
                    key1: 1,
                    key2: '2',
                }
            }

            WebViewJavascriptBridge.callHandler(clientRegistedMethodName, JSON.stringify(param), function (result) {
                // js 调用客户端， 如果客户端有返回值， 就是这个result
                document.getElementById("text").innerText = result;
            })
        }
    </script>
</head>

<body>
    <div class="test">
        <p id="text">1111</p>
        <p id="text2">2222</p>
    </div>
    <button onclick="handleBtnAction()">点击按钮调用原生的 clientRegistedMethod 方法</button>
</body>


<style>
    .test {
        width: 300px;
        height: 200px;
        background-color: aquamarine;
    }
</style>

</html>